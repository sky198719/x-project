require.config({paths:{common:"../common/common"}}),require(["common"],function(e){e.headerLoad("注册/登录",1,!1,"",!1,""),$.fn.cookie("isPass","1",{express:7});var o;$.ajax({url:ajaxlink+"borrowApply/queryChannel.do"+extra,type:"get",dataType:"jsonp",jsonp:"jsonpcallback",success:function(e){if(0==e.resultCode){var a=window.location.href,n=a.indexOf("?channel=");""==e.data?o="未知渠道":$.each(e.data,function(e,t){return t.code==a.substr(n+9,a.length)?(o=t.name,!1):void(o="未知渠道")})}},error:function(){e.alertBox("网络异常请重试")}});var a="",n="";$.ajax({url:ajaxlink+"randCode/getImageCodeUrl.do"+extra,type:"get",dataType:"jsonp",jsonp:"jsonpcallback",success:function(o){0==o.resultCode?($("#verifyCode").find("img").attr("src",o.verifcodeUrl),a=o.verifcodeUrl):e.alertBox(o.msg)},error:function(){e.alertBox("网络异常请重试")}}),$("#verifyCode").find("img").on("click",function(){n=Math.random(),$(this).attr("src",a+"?"+n)});var t,r=60,i=0;$("#messageCode").find("span").on("click",function(){var o=$(this);0==i?0==e.emptyInspect("#verifyCode")&&0==e.mobileInspect("#mobile")&&0==e.emptyInspect("#mobile")?$.ajax({url:ajaxlink+"randCode/checkVerifyCode4xyd.do"+extra,type:"get",dataType:"jsonp",jsonp:"jsonpcallback",data:{verifyCode:$("#verifyCode").find("input").val()},success:function(a){0==a.resultCode?$.ajax({url:ajaxlink+"user/sendSMS4xyd.do"+extra,type:"get",dataType:"jsonp",jsonp:"jsonpcallback",data:{mobile:$("#mobile").find("input").val(),messageCode:$("#verifyCode").find("input").val()},success:function(a){0==a.resultCode?(i=1,e.alertBox(a.msg),r--,o.html(r+"S"),o.addClass("negative"),clearInterval(t),t=setInterval(function(){r--,o.html(r+"S"),r<=0&&(o.html("发送验证码"),o.removeClass("negative"),clearInterval(t),r=60,i=0)},1e3)):($("#verifyCode").find("img").click(),e.alertBox(a.msg))},error:function(){e.alertBox("网络异常请重试")}}):($("#verifyCode").find("img").click(),e.alertBox(a.msg))},error:function(){e.alertBox("网络异常请重试")}}):$("#verifyCode").find("img").click():e.alertBox("短信已发送")}),$(".formBox").find("button").on("click",function(){0==e.emptyInspect("#mobile")&&0==e.emptyInspect("#messageCode")&&0==e.mobileInspect("#mobile")&&$.ajax({url:ajaxlink+"user/checkSMS4xyd.do"+extra,type:"get",dataType:"jsonp",jsonp:"jsonpcallback",data:{mobile:$("#mobile").find("input").val(),messageCode:$("#messageCode").find("input").val()},success:function(a){0==a.resultCode?$.ajax({url:ajaxlink+"user/reg4xyd.do"+extra,type:"post",dataType:"jsonp",jsonp:"jsonpcallback",data:{mobile:$("#mobile").find("input").val(),messageCode:$("#messageCode").find("input").val(),channel:o},success:function(o){0==o.resultCode||1==o.resultCode?window.location.href="info.html":e.alertBox(o.msg)},error:function(){e.alertBox("网络异常请重试")}}):($("#verifyCode").find("img").click(),e.alertBox(a.msg))},error:function(){e.alertBox("请先获取短信验证码")}})})});