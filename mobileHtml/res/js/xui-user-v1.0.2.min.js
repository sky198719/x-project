/*! xui-user-v1.0.2 | isLogin 、 login and register */
define(function(){var a={isLogin:function(b){var f,g=new RegExp("(^| )userToken=([^;]*)(;|$)");if(f=document.cookie.match(g)){e(f[2])}else{b&&b.error&&b.error(f)}function e(c){var d=false;$.ajax({url:"/feapi/users/loginInfo"+"?userToken="+c,dataType:"json",data:{},type:"GET",success:function(h){if(h.code==200000){if(h.data.status.code==200){d=true;var i=setInterval(function(){if(d){clearInterval(i);b&&b.success&&b.success(h)}},10);setTimeout(function(){clearInterval(i)},5000)}else{b&&b.error&&b.error(h)}}else{b&&b.error&&b.error(h)}},error:function(h){b&&b.error&&b.error(h)}})}},Login:function(v){var w={token:"/feapi/users/formToken",login:"/feapi/users/login",vCode:"/feapi/randCode/createVerifyCode"};var t=[{code:100,msg:"请输入用户名"},{code:101,msg:"用户名格式错误"},{code:102,msg:"请输入密码"},{code:103,msg:"请输入验证码"},{code:104,msg:"正在登录，请稍候..."},{code:105,msg:"您已登录成功"},{code:106,msg:"网络连接失败"}];var s,q=v.frame,n=v.user||".ux_login_user",u=v.password||".ux_login_password",p=v.vCode||".ux_login_v_code",b=v.vCodeImg||".ux_login_v_code_img",m=v.submit||".ux_login_submit";$(function(){$.ajax({url:w.token,dataType:"json",type:"GET",data:{},success:function(c){s=c.token;o.getVCode($(q))},error:function(){o.prompt(t[6])}});$(document).on("click",q+" "+m,function(){var c=$(this).parents(".xui-login");r.toSubmit(c)});$(document).on("click",q+" "+b,function(){var c=$(this).parents(".xui-login");o.getVCode(c)})});var o={prompt:function(d){try{if(v.prompt&&typeof(v.prompt)=="function"){v.prompt(d)}}catch(c){}},getVCode:function(c){c.find(b).css("background-image","url("+w.vCode+"?formtoken="+s+"&v="+Math.random()+")")}};var r={toSubmit:function(e){var f=e.find(n),c=e.find(u),h=e.find(p);var d=$.trim(f.val());if(d==""){o.prompt(t[0]);f.focus();return false}var i=$.trim(c.val());if(i==""){o.prompt(t[2]);c.focus();return false}var g=$.trim(h.val());if(g==""){o.prompt(t[3]);h.focus();return false}o.prompt(t[4]);$.ajax({url:w.login,data:{formtoken:s,username:d,password:i,imgcode:g},dataType:"json",type:"POST",success:function(k){var j={code:k.code,msg:k.info};if(v.callback){v.callback(j)}else{if(k.code==="200000"){if(v.success){v.success(j)}else{o.prompt(t[5])}}else{if(k.code==-1){f.val("").focus()}else{if(k.code==-2){h.val("");c.val("").focus()}else{if(k.code==-4){h.val("");c.val("").focus()}else{if(k.code==-40){h.val("").focus()}else{if(k.code==-101){h.val("").focus()}}}}}o.getVCode(e);o.prompt(j)}}},error:function(){o.prompt(t[6])}})}}},Register:function(u){var t={token:"/feapi/users/formToken",checkMobile:"/feapi/users/checkMobile",sendSMS:"/feapi/users/sendSMS",vCode:"/feapi/randCode/createVerifyCode",reg:"/feapi/users/regV3"};var v=[{code:200,msg:"请输入手机号"},{code:201,msg:"手机号格式错误"},{code:202,msg:"请输入密码"},{code:203,msg:"请输入图形验证码"},{code:204,msg:"请输入手机验证码"},{code:205,msg:"正在注册，请稍候..."},{code:206,msg:"您已注册成功"},{code:207,msg:"网络连接失败"},{code:208,msg:"密码需6-16位"},{code:209,msg:"密码需6-16位字母加数字"}];var A,z=$(u.frame),B=u.user||".ux_register_user",s=u.password||".ux_register_password",q=u.vCode||".ux_register_v_code",w=u.vCodeImg||".ux_register_v_code_img",E=u.mCode||".ux_register_m_code",r=u.mCodeBtn||".ux_register_m_code_btn",y=u.submit||".ux_register_submit";$(B).attr("maxlength","11");$(s).attr("maxlength","16");$.ajax({url:t.token,dataType:"json",type:"GET",data:{},success:function(c){A=c.token;b.getVCode(z)},error:function(){b.prompt(v[7])}});C();function C(){$(document).on("click",w,function(){var c=$(this).parents(".xui-register");b.getVCode(c)});$(document).on("click",r,function(){if($(this).hasClass("sending")){}else{var c=$(this).parents(".xui-register");console.log(c);D.getMCode(c)}});$(document).on("click",y,function(){var c=$(this).parents(".xui-register");D.toSubmit(c)})}var b={prompt:function(d){try{if(u.prompt&&typeof(u.prompt)=="function"){u.prompt(d)}}catch(c){}},getVCode:function(c){c.find(w).css("background-image","url("+t.vCode+"?formtoken="+A+"&v="+Math.random()+")")}};var D={getMCode:function(c){var d=c.find(B),i=c.find(s),g=c.find(r),h=c.find(q);var j=$.trim(c.find(B).val());if(j==""){b.prompt(v[0]);d.focus();return false}var f=x(j);if(f===false){b.prompt(v[1]);d.focus();return false}var e=$.trim(c.find(q).val());if(e==""){b.prompt(v[3]);h.focus();return false}$.ajax({url:t.checkMobile,dataType:"json",type:"POST",data:{formtoken:A,mobile:j},success:function(l){var k={code:l.code,msg:l.info};if(l.code===0){b.prompt(k);$(B).focus()}else{if(l.code===1){$.ajax({url:t.sendSMS,dataType:"json",type:"POST",data:{formtoken:A,imgcode:e,mobile:j},success:function(o){var n={code:o.code,msg:o.info};if(o.code==="200000"){$(E).focus();var m=60;var p=setInterval(function(){m--;if(m<0){clearInterval(p);g.removeClass("sending").html("发送验证码")}else{g.addClass("sending").html(m+"秒后重新发送")}},1000)}else{if(o.code===-40){b.getVCode(c);h.val("").focus()}}b.prompt(n)}})}else{b.prompt(k)}}},error:function(){b.prompt(v[7])}})},toSubmit:function(c){var i=$.trim(c.find(B).val());if(i==""){b.prompt(v[0]);
    $(B).focus();return}var f=x(i);if(f===false){b.prompt(v[1]);$(B).val("").focus();return false}var g=$.trim(c.find(s).val());if(g==""){b.prompt(v[2]);$(s).focus();return}var h=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;if(!h.test(g)){b.prompt(v[9]);$(s).val("").focus();return false}var e=$.trim(c.find(q).val());if(e==""){b.prompt(v[3]);$(q).focus();return}var d=$.trim(c.find(E).val());if(d==""){b.prompt(v[4]);$(E).focus();return}b.prompt(v[5]);$.ajax({url:t.reg,dataType:"json",type:"POST",data:{formtoken:A,mobile:i,password:g,smscode:d,},success:function(j){var k={code:j.code,msg:j.info};if(u.callback){u.callback(k)}else{if(j.regResultCode=="200000"){if(u.success){u.success(k)}else{b.prompt(v[6])}}else{if(j.code==1025){$(E).val("").focus()}b.prompt(k)}}},error:function(){b.prompt(v[7])}})}};function x(d){var c=/^0?(13|15|14|17|18)[0-9]{9}$/;if(c.test(d)){return true}else{return false}}}};return a});