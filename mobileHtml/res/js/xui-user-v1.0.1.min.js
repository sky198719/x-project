/*! xui-user-v1 | login and register */
define(function(){var a={isLogin:function(){function c(f){var g,b=new RegExp("(^| )"+f+"=([^;]*)(;|$)");if(g=document.cookie.match(b)){return(g[2])}else{return null}}var d=false;$.ajax({url:"/feapi/users/loginInfo"+"?userToken="+c("userToken"),dataType:"json",data:{},async:false,type:"GET",success:function(b){if(b.code==200000){if(b.data.status.code==200){d=true}}}});return d},Login:function(s){var r={token:"/feapi/users/formToken",login:"/feapi/users/login",vCode:"/feapi/randCode/createVerifyCode"};var p=[{code:100,msg:"请输入用户名"},{code:101,msg:"用户名格式错误"},{code:102,msg:"请输入密码"},{code:103,msg:"请输入验证码"},{code:104,msg:"正在登录，请稍候..."},{code:105,msg:"您已登录成功"},{code:106,msg:"网络连接失败"}];var o,m=s.frame,v=s.user||".ux_login_user",q=s.password||".ux_login_password",x=s.vCode||".ux_login_v_code",t=s.vCodeImg||".ux_login_v_code_img",u=s.submit||".ux_login_submit";$(function(){$.ajax({url:r.token,dataType:"json",type:"GET",data:{},success:function(b){o=b.token;w.getVCode($(m))},error:function(){w.prompt(p[6])}});$(document).on("click",m+" "+u,function(){var b=$(this).parents(".xui-login");n.toSubmit(b)});$(document).on("click",m+" "+t,function(){var b=$(this).parents(".xui-login");w.getVCode(b)})});var w={prompt:function(c){try{if(s.prompt&&typeof(s.prompt)=="function"){s.prompt(c)}}catch(b){}},getVCode:function(b){b.find(t).css("background-image","url("+r.vCode+"?formtoken="+o+"&v="+Math.random()+")")}};var n={toSubmit:function(d){var e=d.find(v),b=d.find(q),g=d.find(x);var c=$.trim(e.val());if(c==""){w.prompt(p[0]);e.focus();return false}var h=$.trim(b.val());if(h==""){w.prompt(p[2]);b.focus();return false}var f=$.trim(g.val());if(f==""){w.prompt(p[3]);g.focus();return false}w.prompt(p[4]);$.ajax({url:r.login,data:{formtoken:o,username:c,password:h,imgcode:f},dataType:"json",type:"POST",success:function(k){var j={code:k.code,msg:k.info};try{if(s.callback&&typeof(s.callback)=="function"){s.callback(j)}else{if(k.code==="200000"){try{if(s.success&&typeof(s.success)=="function"){s.success(j)}else{w.prompt(p[5])}}catch(i){}}else{if(k.code==-1){e.val("").focus()}else{if(k.code==-2){g.val("");b.val("").focus()}else{if(k.code==-4){g.val("");b.val("").focus()}else{if(k.code==-40){g.val("").focus()}else{if(k.code==-101){g.val("").focus()}}}}}w.getVCode(d);w.prompt(j)}}}catch(i){}},error:function(){w.prompt(p[6])}})}}},Register:function(w){var v={token:"/feapi/users/formToken",checkMobile:"/feapi/users/checkMobile",sendSMS:"/feapi/users/sendSMS",vCode:"/feapi/randCode/createVerifyCode",reg:"/feapi/users/regV3"};var x=[{code:200,msg:"请输入手机号"},{code:201,msg:"手机号格式错误"},{code:202,msg:"请输入密码"},{code:203,msg:"请输入图形验证码"},{code:204,msg:"请输入手机验证码"},{code:205,msg:"正在注册，请稍候..."},{code:206,msg:"您已注册成功"},{code:207,msg:"网络连接失败"},{code:208,msg:"密码需6-16位"},{code:209,msg:"密码需6-16位字母加数字"}];var q,B=$(w.frame),C=w.user||".ux_register_user",u=w.password||".ux_register_password",F=w.vCode||".ux_register_v_code",y=w.vCodeImg||".ux_register_v_code_img",s=w.mCode||".ux_register_m_code",t=w.mCodeBtn||".ux_register_m_code_btn",A=w.submit||".ux_register_submit";$(C).attr("maxlength","11");$(u).attr("maxlength","16");$.ajax({url:v.token,dataType:"json",type:"GET",data:{},success:function(b){q=b.token;E.getVCode(B)},error:function(){E.prompt(x[7])}});D();function D(){$(document).on("click",y,function(){var b=$(this).parents(".xui-register");E.getVCode(b)});$(document).on("click",t,function(){if($(this).hasClass("sending")){}else{var b=$(this).parents(".xui-register");console.log(b);r.getMCode(b)}});$(document).on("click",A,function(){var b=$(this).parents(".xui-register");r.toSubmit(b)})}var E={prompt:function(b){try{if(w.prompt&&typeof(w.prompt)=="function"){w.prompt(b)}}catch(c){}},getVCode:function(b){b.find(y).css("background-image","url("+v.vCode+"?formtoken="+q+"&v="+Math.random()+")")}};var r={getMCode:function(c){var d=c.find(C),i=c.find(u),g=c.find(t),h=c.find(F);var b=$.trim(c.find(C).val());if(b==""){E.prompt(x[0]);d.focus();return false}var f=z(b);if(f===false){E.prompt(x[1]);d.focus();return false}var e=$.trim(c.find(F).val());if(e==""){E.prompt(x[3]);h.focus();return false}$.ajax({url:v.checkMobile,dataType:"json",type:"POST",data:{formtoken:q,mobile:b},success:function(k){var j={code:k.code,msg:k.info};if(k.code===0){E.prompt(j);$(C).focus()}else{if(k.code===1){$.ajax({url:v.sendSMS,dataType:"json",type:"POST",data:{formtoken:q,imgcode:e,mobile:b},success:function(o){var n={code:o.code,msg:o.info};if(o.code==="200000"){$(s).focus();var m=60;var l=setInterval(function(){m--;if(m<0){clearInterval(l);g.removeClass("sending").html("发送验证码")}else{g.addClass("sending").html(m+"秒后重新发送")}},1000)}else{if(o.code===-40){E.getVCode(c);h.val("").focus()}}E.prompt(n)}})}else{E.prompt(j)}}},error:function(){E.prompt(x[7])}})},toSubmit:function(c){var b=$.trim(c.find(C).val());if(b==""){E.prompt(x[0]);$(C).focus();return}var f=z(b);if(f===false){E.prompt(x[1]);$(C).val("").focus();return false}var g=$.trim(c.find(u).val());
    if(g==""){E.prompt(x[2]);$(u).focus();return}var h=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;if(!h.test(g)){E.prompt(x[9]);$(u).val("").focus();return false}var e=$.trim(c.find(F).val());if(e==""){E.prompt(x[3]);$(F).focus();return}var d=$.trim(c.find(s).val());if(d==""){E.prompt(x[4]);$(s).focus();return}E.prompt(x[5]);$.ajax({url:v.reg,dataType:"json",type:"POST",data:{formtoken:q,mobile:b,password:g,smscode:d,},success:function(k){var i={code:k.code,msg:k.info};try{if(w.callback&&typeof(w.callback)=="function"){w.success(i)}else{if(k.regResultCode=="200000"){try{if(w.success&&typeof(w.success)=="function"){w.success(i)}else{E.prompt(x[6])}}catch(j){}}else{if(k.code==1025){$(s).val("").focus()}E.prompt(i)}}}catch(j){}},error:function(){E.prompt(x[7])}})}};function z(b){var c=/^0?(13|15|14|17|18)[0-9]{9}$/;if(c.test(b)){return true}else{return false}}}};return a});