require.config({paths:{common:"../common/common"}}),require(["common"],function(e){var a,t,i,n,l,o,d=1,s=0,r=1,c=window.location.href,p=c.indexOf("applyCode="),u=c.indexOf("&userId="),f=c.indexOf("&idCode=");$("#orderId").html(c.substring(p+10,u));var g=c.substring(u+8,f),m=c.substr(f+8,c.length),v={errorBox:function(){alert("网络异常，请刷新页面后重试！"),v.loadingOut()},loadingIn:function(){$(".loading").fadeIn(0)},loadingOut:function(){$(".loading").fadeOut(0)},loadingAnimate:function(){var e=0;setInterval(function(){++e>=12&&(e=0),$("#upload b").removeClass("hasUpload").eq(e).addClass("hasUpload")},100)},listLoad:function(){$(window).scroll(function(){if($(window).scrollTop()+document.body.clientHeight>=$(document).height()){if("RECEIPT_IDCARDNO"==$("#navList").find(".current").attr("value")||"RECEIPT_FACE_RECOGNITION"==$("#navList").find(".current").attr("value"))return!1;r++,R.listData(o)}$(window).scrollTop()>=100?$(".leftBar").css({position:"fixed",top:"0px"}):$(".leftBar").css({position:"absolute",top:"100px"})})},myDate:function(){a=new Date,t=a.getTime()},closeBox:function(){$(".close").click(function(){$(".alerts").fadeOut(0),$(".layer").fadeOut(0),$(".picReview .m").removeAttr("style"),$(".picReview .m img").removeAttr("style").attr("src",""),$(".picReview .t em a").attr("href",""),$(".videoReview video").attr("src",""),$(".audioReview audio").attr("src","")})},navControl:function(){$(document).on("click","#navList li",function(){var e=$(this).index();r=1,$("#navList li").removeClass("current").eq(e).addClass("current"),o=$(this).attr("value"),$("#fileList").empty(),$("#fileList").append('<li id="upload"><span><input type="file" id="uploadFile" name="file" /></span><strong>上传图片</strong></li>'),R.listData(o)})},listImg:function(){$.each($("#fileList li span img"),function(){$(this).load(function(){var e=$(this);e.width()>=e.height()?e.css({width:"145px",top:(145-145*e.height()/e.width())/2+"px",left:"0px"}):e.css({height:"145px",top:"0px",left:(145-145*e.width()/e.height())/2+"px"})})})},listControl:function(){$("#fileList").children("li").hover(function(){var e=$(this);$(this).index();e.find("div").stop().animate({top:"0px"},200)},function(){$(this).find("div").stop().animate({top:"-145px"},200)})},videoReview:function(){$(".bigVideo").click(function(){$(".videoReview video").attr("src",$(this).attr("value")),$(".videoReview").fadeIn(0),$(".layer").fadeIn(0)})},audioReview:function(){$(".bigAudio").click(function(){$(".audioReview audio").attr("src",$(this).attr("value")),$(".audioReview").fadeIn(0),$(".layer").fadeIn(0)})},imgReview:function(){$(".bigPic").click(function(){s=0,$(".loading").fadeIn(0),$(".picReview .m img").attr("src",$(this).attr("value")),$(".picReview .t em a").attr("href",$(this).attr("value")+"&attname=")})},boxInit:function(){$(".picReview").css({"margin-top":-$(".picReview").height()/2+"px","margin-left":-$(".picReview").width()/2+"px"})},boxRotate:function(){$(".picReview .t strong").click(function(){var e=$(".picReview .m").width(),a=$(".picReview .m").height();$(".picReview .m").css({width:e+"px",height:a+"px"}),4==++s&&(s=0),e>=a?s%2!=0?($(".picReview .m img").css({width:a+"px","margin-left":(e-a)/2+"px","margin-top":(a-a/e*a)/2+"px"}),$(".picReview .m img").css({transform:"rotate("+90*s+"deg)","-ms-transform":"rotate("+90*s+"deg)","-moz-transform":"rotate("+90*s+"deg)","-webkit-transform":"rotate("+90*s+"deg)","-o-transform":"rotate("+90*s+"deg)"})):($(".picReview .m img").css({width:e+"px","margin-left":"0","margin-top":"0"}),$(".picReview .m img").css({transform:"rotate("+90*s+"deg)","-ms-transform":"rotate("+90*s+"deg)","-moz-transform":"rotate("+90*s+"deg)","-webkit-transform":"rotate("+90*s+"deg)","-o-transform":"rotate("+90*s+"deg)",width:e+"px"})):s%2!=0?($(".picReview .m img").css({height:e+"px","margin-left":(e-e/a*e)/2+"px","margin-top":(a-e)/2+"px"}),$(".picReview .m img").css({transform:"rotate("+90*s+"deg)","-ms-transform":"rotate("+90*s+"deg)","-moz-transform":"rotate("+90*s+"deg)","-webkit-transform":"rotate("+90*s+"deg)","-o-transform":"rotate("+90*s+"deg)"})):($(".picReview .m img").css({height:a+"px","margin-left":"0","margin-top":"0"}),$(".picReview .m img").css({transform:"rotate("+90*s+"deg)","-ms-transform":"rotate("+90*s+"deg)","-moz-transform":"rotate("+90*s+"deg)","-webkit-transform":"rotate("+90*s+"deg)","-o-transform":"rotate("+90*s+"deg)",height:a+"px"}))})},zipList:function(){$("#downloadList").click(function(){d=1,R.downloadlistData(d),$(".zipList").fadeIn(0),$(".layer").fadeIn(0)})},dataUpdate:function(e){return e.toString().length<=1?"0"+e:e},downloadPre:function(){$("#downloadPre").click(function(){if(d<=1)return alert("已经是第一页！"),!1;d--,R.downloadlistData(d)})},downloadNext:function(){$("#downloadNext").click(function(){if(d>=i)return alert("已经是最后一页！"),!1;d++,R.downloadlistData(d)})},downloadReflash:function(){$("#ziplistReflash").click(function(){d=1,R.downloadlistData(d)})},zipDelete:function(){$(".zipDelete").click(function(){if(!confirm("打包文件删除后不可恢复！是否确认删除？"))return!1;R.deleteData($(this).parent("em").parent("li").attr("value"))})},toZip:function(){$("#toZip").click(function(){if(!confirm("是否确认该页面所有文件打包？"))return!1;R.zipData()})}},R={categoryDate:function(){$.ajax({url:ajaxlink+"/receipt/categories",type:"get",cache:!1,data:{code:"RECEIPT_FILE"},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert(e.message),v.loadingOut(),!1;$("#navList").empty(),$.each(e.data.category.items,function(e,a){$("#navList").append('<li value="'+a.code+'">'+a.message+"</li>")}),$("#navList").children("li").eq(0).addClass("current"),o=$("#navList").children("li").eq(0).attr("value"),$("#fileList").empty(),$("#fileList").append('<li id="upload"><span><input type="file" id="uploadFile" name="file" /></span><strong>上传图片</strong></li>'),R.listData(o)},error:function(){v.errorBox()}})},listData:function(e){"RECEIPT_IDCARDNO"==e?$.ajax({url:ajaxlink2+"/user/appro/realNamePic",type:"get",cache:!1,data:{idCardNumber:m},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(a){if("200000"!=a.code)return alert(a.message),v.loadingOut(),!1;if(0==a.data.code){var i=a.data.data.positivePicUrl,n=a.data.data.negativePicUrl,l=i.substring(0,4);n.substring(0,4);"http"==l?($("#fileList").append('<li class="image"><span><img src="'+a.data.data.positivePicUrl+'" /><div><ul><li value="'+a.data.data.positivePicUrl+'" class="bigPic">查看大图</li><li><a href="'+a.data.data.positivePicUrl+'?&attname=" target="_blank">下载</a></li></ul></div></span><strong>身份证正面</strong></li>'),$("#fileList").append('<li class="image"><span><img src="'+a.data.data.negativePicUrl+'" /><div><ul><li value="'+a.data.data.negativePicUrl+'" class="bigPic">查看大图</li><li><a href="'+a.data.data.negativePicUrl+'?&attname=" target="_blank">下载</a></li></ul></div></span><strong>身份证反面</strong></li>')):($("#fileList").append('<li class="image"><span><img src="../../../../'+a.data.data.positivePicUrl+'" /><div><ul><li value="../../../../'+a.data.data.positivePicUrl+'" class="bigPic">查看大图</li><li><a href="../../../../'+a.data.data.positivePicUrl+'&attname=" target="_blank">下载</a></li></ul></div></span><strong>身份证正面</strong></li>'),$("#fileList").append('<li class="image"><span><img src="../../../..'+a.data.data.negativePicUrl+'" /><div><ul><li value="../../../..'+a.data.data.negativePicUrl+'" class="bigPic">查看大图</li><li><a href="../../../..'+a.data.data.negativePicUrl+'&attname=" target="_blank">下载</a></li></ul></div></span><strong>身份证反面</strong></li>')),$.ajax({url:ajaxlink+"/receipt/files",type:"get",cache:!1,data:{applyCode:$("#orderId").html(),sourceType:"BACKEND",categoryCode:e,watermarkFlag:"WATERMARK_YES",thumbnailFlag:"THUMBNAIL_YES",currentPage:r,pageSize:30},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert(e.message),v.loadingOut(),!1;"DATA_NOT_FOUND"!=e.data.status.code&&$.each(e.data.items,function(e,a){"IMAGE"==a.fileType?$("#fileList").append('<li class="image"><span><img src="'+a.thumbnailURL+'" /><div><ul><li value="'+a.downLoadURL+'" class="bigPic">查看大图</li><li><a href="'+a.downLoadURL+'&attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"TXT"==a.fileType?$("#fileList").append('<li class="doc"><span><div><ul><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"VIDEO"==a.fileType?$("#fileList").append('<li class="media"><span><div><ul><li value="'+a.downLoadURL+'" class="bigVideo">预览文件</li><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"AUDIO"==a.fileType&&$("#fileList").append('<li class="media"><span><div><ul><li value="'+a.downLoadURL+'" class="bigAudio">预览文件</li><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>")}),v.listControl(),v.listImg(),v.imgReview(),$(".picReview .m img").load(function(){v.boxInit(),$(".picReview").fadeIn(0),$(".layer").fadeIn(0),$(".loading").fadeOut(0)}),v.videoReview(),v.audioReview(),R.uploadFile()}})}v.listControl(),v.listImg(),v.imgReview(),$(".picReview .m img").load(function(){v.boxInit(),$(".picReview").fadeIn(0),$(".layer").fadeIn(0),$(".loading").fadeOut(0)}),v.videoReview(),v.audioReview(),R.uploadFile()},error:function(){v.errorBox()}}):"RECEIPT_FACE_RECOGNITION"==e?$.ajax({url:ajaxlink2+"/user/appro/facePics",type:"get",cache:!1,data:{idCardNumber:m},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(a){if("200000"!=a.code)return alert(a.message),v.loadingOut(),!1;0==a.data.code&&($.each(a.data.data,function(e,a){$("#fileList").append('<li class="image"><span><img src="'+a.downLoadURL+'" /><div><ul><li value="'+a.downLoadURL+'" class="bigPic">查看大图</li><li><a href="'+a.downLoadURL+'?&attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>")}),$.ajax({url:ajaxlink+"/receipt/files",type:"get",cache:!1,data:{applyCode:$("#orderId").html(),sourceType:"BACKEND",categoryCode:e,watermarkFlag:"WATERMARK_YES",thumbnailFlag:"THUMBNAIL_YES",currentPage:r,pageSize:30},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert(e.message),v.loadingOut(),!1;"DATA_NOT_FOUND"!=e.data.status.code&&$.each(e.data.items,function(e,a){"IMAGE"==a.fileType?$("#fileList").append('<li class="image"><span><img src="'+a.thumbnailURL+'" /><div><ul><li value="'+a.downLoadURL+'" class="bigPic">查看大图</li><li><a href="'+a.downLoadURL+'&attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"TXT"==a.fileType?$("#fileList").append('<li class="doc"><span><div><ul><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"VIDEO"==a.fileType?$("#fileList").append('<li class="media"><span><div><ul><li value="'+a.downLoadURL+'" class="bigVideo">预览文件</li><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"AUDIO"==a.fileType&&$("#fileList").append('<li class="media"><span><div><ul><li value="'+a.downLoadURL+'" class="bigAudio">预览文件</li><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>")}),v.listControl(),v.listImg(),v.imgReview(),$(".picReview .m img").load(function(){v.boxInit(),$(".picReview").fadeIn(0),$(".layer").fadeIn(0),$(".loading").fadeOut(0)}),v.videoReview(),v.audioReview(),R.uploadFile()}})),v.listControl(),v.listImg(),v.imgReview(),$(".picReview .m img").load(function(){v.boxInit(),$(".picReview").fadeIn(0),$(".layer").fadeIn(0),$(".loading").fadeOut(0)}),v.videoReview(),v.audioReview(),R.uploadFile()},error:function(){v.errorBox()}}):$.ajax({url:ajaxlink+"/receipt/files",type:"get",cache:!1,data:{applyCode:$("#orderId").html(),sourceType:"BACKEND",categoryCode:e,watermarkFlag:"WATERMARK_YES",thumbnailFlag:"THUMBNAIL_YES",currentPage:r,pageSize:30},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert(e.message),v.loadingOut(),!1;"DATA_NOT_FOUND"!=e.data.status.code&&$.each(e.data.items,function(e,a){"IMAGE"==a.fileType?$("#fileList").append('<li class="image"><span><img src="'+a.thumbnailURL+'" /><div><ul><li value="'+a.downLoadURL+'" class="bigPic">查看大图</li><li><a href="'+a.downLoadURL+'&attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"TXT"==a.fileType?$("#fileList").append('<li class="doc"><span><div><ul><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"VIDEO"==a.fileType?$("#fileList").append('<li class="media"><span><div><ul><li value="'+a.downLoadURL+'" class="bigVideo">预览文件</li><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>"):"AUDIO"==a.fileType&&$("#fileList").append('<li class="media"><span><div><ul><li value="'+a.downLoadURL+'" class="bigAudio">预览文件</li><li><a href="'+a.downLoadURL+'?attname=" target="_blank">下载</a></li></ul></div></span><strong>'+a.fileName+"</strong></li>")}),v.listControl(),v.listImg(),v.imgReview(),$(".picReview .m img").load(function(){v.boxInit(),$(".picReview").fadeIn(0),$(".layer").fadeIn(0),$(".loading").fadeOut(0)}),v.videoReview(),v.audioReview(),R.uploadFile()},error:function(){v.errorBox()}})},downloadlistData:function(e){$.ajax({url:ajaxlink+"/receipt/packages",type:"get",cache:!1,data:{applyCode:$("#orderId").html(),currentPage:e,pageSize:6},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(a){if("200000"!=a.code)return alert(a.message),v.loadingOut(),!1;$("#zipList").empty(),$("#zipList").append("<li><span>状态</span><strong>时间</strong><em>操作</em></li>"),"DATA_NOT_FOUND"!=a.data.status.code&&(i=a.data.totalCount%6==0?parseInt(a.data.totalCount/6):parseInt(a.data.totalCount/6+1),$.each(a.data.items,function(e,a){"PACKAGING"==a.status?$("#zipList").append('<li value="'+a.packageId+'"><span>打包中</span><strong>'+new Date(a.updateTime).getFullYear()+"/"+v.dataUpdate(new Date(a.updateTime).getMonth()+1)+"/"+v.dataUpdate(new Date(a.updateTime).getDate())+" "+v.dataUpdate(new Date(a.updateTime).getHours())+":"+v.dataUpdate(new Date(a.updateTime).getMinutes())+":"+v.dataUpdate(new Date(a.updateTime).getSeconds())+"</strong><em><p></p><b></b></em></li>"):$("#zipList").append('<li class="zipOk" value="'+a.packageId+'"><span>可下载</span><strong>'+new Date(a.updateTime).getFullYear()+"/"+v.dataUpdate(new Date(a.updateTime).getMonth()+1)+"/"+v.dataUpdate(new Date(a.updateTime).getDate())+" "+v.dataUpdate(new Date(a.updateTime).getHours())+":"+v.dataUpdate(new Date(a.updateTime).getMinutes())+":"+v.dataUpdate(new Date(a.updateTime).getSeconds())+'</strong><em><p><a href="'+a.downLoadURL+'?attname=" target="_blank"></a></p><b class="zipDelete"></b></em></li>')}),$("#downloadPage").html(e+"/"+i)),v.zipDelete()},error:function(){v.errorBox()}})},deleteData:function(e){v.loadingIn(),$.ajax({url:ajaxlink+"/receipt/packages?packageId="+e,type:"delete",cache:!1,beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert(e.message),v.loadingOut(),!1;alert(e.data.status.message),v.loadingOut(),d=1,R.downloadlistData(d)},error:function(){v.errorBox()}})},zipData:function(){v.loadingIn(),$.ajax({url:ajaxlink+"/receipt/packages",type:"post",cache:!1,data:{applyCode:$("#orderId").html()},beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert(e.message),v.loadingOut(),!1;alert(e.data.status.message),v.loadingOut(),d=1,R.downloadlistData(d),$(".zipList").fadeIn(0),$(".layer").fadeIn(0)},error:function(){v.errorBox()}})},uploadFile:function(){$("#uploadFile").fileupload({url:ajaxlink+"/files",autoUpload:!0,type:"post",cache:!1,formData:{bizCode:"RECEIPT_APPLY_FILE"},acceptFileTypes:/\.(jpg|jpeg|bmp|png|doc|docx|xls|xlsx|ppt|pptx|pdf|avi|rmvb|mp4|mp3)$/i,maxFileSize:524288e3,beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},processfail:function(){$(".layer").fadeIn(0),$(".error").fadeIn(0)},progressall:function(e,a){var t=parseInt(a.loaded/a.total*100);$("#uploadProgress").html(t+"%"),$(".layer").fadeIn(0),$(".upload").fadeIn(0)},success:function(e){if("200000"!=e.code)return alert(e.message),!1;n=e.data.fileId,l=e.data.fileType,R.uploadParma()},done:function(e,a){},fail:function(){v.errorBox()}})},uploadParma:function(){$.ajax({url:ajaxlink+"/receipt/files",type:"post",cache:!1,headers:{"Content-Type":"application/json"},data:'{"data":{"applyCode":"'+$("#orderId").html()+'","categoryCode":"'+o+'","sourceType":"BACKEND","fileId":"'+n+'","fileType":"'+l+'","userId":"'+g+'"}}',beforeSend:function(e){v.myDate(),e.setRequestHeader("clientId","SHENZHOURONG_FRONT_END"),e.setRequestHeader("clientTime",t)},success:function(e){if("200000"!=e.code)return alert("上传失败！"),$(".layer").fadeOut(0),$(".upload").fadeOut(0),!1;alert("上传成功！"),$(".layer").fadeOut(0),$(".upload").fadeOut(0),$("#fileList").empty(),$("#fileList").append('<li id="upload"><span><input type="file" id="uploadFile" name="file" /></span><strong>上传图片</strong></li>'),r=1,R.listData(o)},error:function(){v.errorBox()}})}};v.loadingAnimate(),v.boxRotate(),v.closeBox(),v.listLoad(),R.categoryDate(),v.downloadPre(),v.downloadNext(),v.downloadReflash(),v.navControl(),v.zipList(),v.toZip()});