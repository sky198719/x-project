define(["base"],function(t){function a(a){var o=a.self,e=a.formatCallback,r=a.cache,l=t(o),c="<div id='J_calculatorTipToolTip' class='mui-calculator-tip-tooltip clearfix'><div class='mui-calculator-tip-arrow mui-calculator-tip-arrowTop'><div class='mui-calculator-tip-arrowIn'></div></div><div class='mui-calculator-tip-block'></div></div>";this._hash||(this._hash={});var n={self:o,$content:t(c),showCall:a.showCall||void 0,hideCall:a.hideCall||void 0},s=l.attr("tipContent"),u=l.attr("dataUrl");if(s){var d=l.attr("_tipDate");if(d){var f=this._hash,p=f[l.attr("_tipDate")];if(p){if(n.$content=t("#"+p),!r&&e){var h=e(s,l);n.$content.find(".mui-calculator-tip-block").html(h)}i(n)}else t.log("dom is error")}else{var f=this._hash,d=(new Date).getTime();f[d]="J_calculatorTipToolTip"+d,l.attr("_tipDate",d);var h="";h=e?e(s,l):s,n.$content.attr("id",f[d]).find(".mui-calculator-tip-block").html(h),i(n)}}else if(u){var f=this._hash,p=f[u];if(p&&r)n.$content=t("#"+p),i(n);else{var v=l.attr("tipType");if("jsonp"==v)t.ajax({dataType:"jsonp",url:u,jsonp:"jsonpcallback",success:function(t){if(200==t.status){var a=e(t.data);f[u]="J_calculatorTipToolTip"+(new Date).getTime(),n.$content.attr("id",f[u]).find(".mui-calculator-tip-block").html(a),i(n)}}});else{"get"!=v&&"post"!=v&&(v="get");var m=l.attr("dataType")||"json";t.ajax({type:v,dataType:m,url:u,success:function(t){var a="";if("json"!=m)a=t;else{if(200!=t.status)return;a=t.data}var o=e(a,l);f[u]="J_calculatorTipToolTip"+(new Date).getTime(),n.$content.attr("id",f[u]).find(".mui-calculator-tip-block").html(o),i(n)}})}}}else t.log("params is error , tipContent or dataUrl must choose a parameter ")}var o={fnMouseTip:function(a,o,i,e){var r=t(o),l=this;if(t(a).on("mouseover",function(){l.fnTip(params)}),e){var c=r.find(".close");c.addClass("hide"),e()}},fnTip:function(a,o,i,e){function r(i){var n=i||window.event,s=n.target,u=c.attr("id"),d=t(s).attr("id");("false"===l||d!=u&&!o.contains(s))&&(t(a).attr("id")==u||a.contains(s)||(e&&e(),c.hide(),t(document).unbind("mousemove",r)))}var i=i||void 0,e=e||void 0,l=a.getAttribute("overTipShow")||void 0,c=t(o);c.show(),i&&i(),t(document).on("mousemove",r)},loadTpl:function(a,o){var i=t.ajax({url:a,async:!1});if(4==i.readyState)return i.responseData}},i=function(a){function i(){var t=0;(S<=20||D<=20)&&(t=20),D>=M&&S>=M||k<j?(I=T-M,N=U-10):D>=S&&D>=M?(I=T-j+S+A+t,N=j-S-10-t):(I=T-D-t,N=D+A-10+t)}function e(){var t=0;(H<=20||x<=20)&&(t=20),H>=B&&x>=B||C<y?(J=w-B,L=q-10):H>x&&H>=B?(J=w-y+x+z+t,L=y-x-10-t):(J=w-H-t,L=H+z-10+t)}function r(){W="mui-calculator-tip-arrow-right",L=y-12,J=w-y,i()}function l(){W="mui-calculator-tip-arrow-left",L=0,J=w+_,i()}function c(){W="mui-calculator-tip-arrow-down",N=j-12,I=T-j,e()}function n(){W="mui-calculator-tip-arrow-top",N=0,I=T+g,e()}function s(){H>x?r():l()}function u(){D>S?c():n()}function d(){for(var t=[c,l,n,r],a=[D,x,S,H],o=0,i=a[0],e=1,s=a.length;e<s;e++)i<a[e]&&(i=a[e],o=e);t[o]()}var f=a.self,p=a.$content,h=a.showCall,v=a.hideCall;$self=t(f),contentId=p.attr("id"),checkNode=t("#"+contentId),checkNode.length?p=checkNode:t("body").append(p);var m=$self.offset(),T=m.top,w=m.left,g=$self.outerHeight(),_=$self.outerWidth(),$=t(document);_docScrollTop=$.scrollTop(),_docScrollLeft=$.scrollLeft(),_docHeight=$.outerHeight();var b=t(window),k=b.outerHeight(),C=b.outerWidth(),j=p.outerHeight(),y=p.outerWidth(),D=T-_docScrollTop,S=k-D-g,H=w-_docScrollLeft,x=C-H-_,J=0,I=0,L=0,N=0,W="mui-calculator-tip-arrow-down",U=j/2,A=g/2,M=U-A,q=y/2,z=_/2,B=q-z,E=$self.attr("position");"left"==E?r():"right"==E?l():"top"==E?c():"bottom"==E?n():"slide"==E?s():"fluctuate"==E?u():d(),p.css({left:J,top:I}),p.find(".mui-calculator-tip-arrow").css({left:L,top:N}).attr("class","mui-calculator-tip-arrow "+W);var F=p[0];o.fnTip(f,F,h,v)};return{init:a,manual:i}});